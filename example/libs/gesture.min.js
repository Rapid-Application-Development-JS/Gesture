!function(t,n){"function"==typeof define&&define.amd?define(function(){return t.GestureTracker=n()}):"object"==typeof module&&module.exports?module.exports=t.GestureTracker=n():t.GestureTracker=n()}(this,function(){function t(t,n){function e(){function t(t){return{start:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},pre:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},last:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp},end:{clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp}}}var n=this,e={},i=0;n.getCount=function(){return i},n.hasEvent=function(t){return e[t]?!0:!1},n.setNewEvent=function(o){n.hasEvent(o.pointerId)||i++,e[o.pointerId]=t(o)},n.getTrack=function(t){return e[t]},n.removeEvent=function(t){n.hasEvent(t)&&i--,e[t]=null},n.calculateDistance=function(t,n,e,i){return Math.pow((n-t)*(n-t)+(i-e)*(i-e),.5)},n.updateEvent=function(t){e[t.pointerId].pre.clientX=e[t.pointerId].last.clientX,e[t.pointerId].pre.clientY=e[t.pointerId].last.clientY,e[t.pointerId].pre.timeStamp=e[t.pointerId].last.timeStamp,e[t.pointerId].last.clientX=t.clientX,e[t.pointerId].last.clientY=t.clientY,e[t.pointerId].last.timeStamp=t.timeStamp},n.setEndEvent=function(t){e[t.pointerId].end.clientX=t.clientX,e[t.pointerId].end.clientY=t.clientY,e[t.pointerId].end.timeStamp=t.timeStamp}}function i(t,n,e){var i,o,a,r=this,c={},l=p({tapDuration:300,tapDelay:300,doubleGuardState:!0},e),u=D.GESTURE_EVENTS.tap,s=t;r.pointerDown=function(){i=!0},r.pointerMove=function(){i=!1},r.getDoubleGuardState=function(){return l.doubleGuardState},r.setDoubleGuardState=function(t){l.doubleGuardState=t},r.pointerUp=function(t){var e=s.getTrack(t.pointerId);i&&(e.end.timeStamp-e.start.timeStamp<l.tapDuration?!a||e.end.timeStamp-a>l.tapDelay?(a=e.end.timeStamp,l.doubleGuardState?o=setTimeout(function(){n(u,t,c),o=null}.bind(r),l.tapDelay):n(u,t,c)):(l.doubleGuardState&&(clearTimeout(o),o=null),n(D.GESTURE_EVENTS.doubletap,t,c)):n(D.GESTURE_EVENTS.longtap,t,c)),i=!1},r.pointerCancel=function(){},r.pointerLeave=function(){},r.pointerOut=function(){}}function o(t,n){function e(t){l&&(clearTimeout(l),c&&(r.action="holdend",console.log("send holdend from pointerMove"),n(a,t,r),c=!1),l=null)}var i=this,o=500,a=D.GESTURE_EVENTS.hold,r={},c=!1,l=null;i.pointerDown=function(t){clearTimeout(o),l=setTimeout(function(){c||(r.action="holdstart",n(a,t,r),c=!0)}.bind(i),o)},i.pointerMove=function(t){e(t)},i.pointerUp=function(t){e(t)},i.pointerCancel=function(t){e(t)},i.pointerLeave=function(t){e(t)},i.pointerOut=function(t){e(t)}}function a(t,n){var e=this,i=D.GESTURE_EVENTS.fling,o={},a=50;x=t,e.pointerDown=function(){},e.pointerMove=function(){},e.pointerUp=function(t){var e=x.getTrack(t.pointerId),r=x.calculateDistance(e.end.clientX,e.pre.clientX,e.end.clientY,e.pre.clientY),c=Math.abs(r)>0&&e.end.timeStamp-e.start.timeStamp>a;c&&(o.start=e.start,o.end=e.end,o.duration=e.end.timeStamp-e.start.timeStamp,o.speedX=(e.end.clientX-e.pre.clientX)/o.duration,o.speedY=(e.end.clientY-e.pre.clientY)/o.duration,o.speed=r/o.duration,n(i,t,o))},e.pointerCancel=function(){},e.pointerLeave=function(){},e.pointerOut=function(){}}function r(t,n){function e(){for(var t,n,e=c.getTrack(0).last.clientX,i=c.getTrack(0).last.clientY,o=e,a=i,r=1;r!==c.getCount();r++)t=c.getTrack(r).last,e<t.clientX&&(e=t.clientX),o>t.clientX&&(o=t.clientX),i<t.clientY&&(i=t.clientY),a>t.clientY&&(a=t.clientY);return n={x:o+(e-o)/2,y:a+(i-a)/2}}var i,o=this,a=D.GESTURE_EVENTS.rotate,r={angle:0},c=t,l={rotatestart:"rotatestart",rotatemove:"rotatemove",rotateend:"rotateend"};o.pointerDown=function(){},o.pointerMove=function(t){if(c.getCount()>1){var o,u,p=e(),s=0;if(r.center=p,i){for(var d=0;d!==c.getCount();d++)o=c.getTrack(d),u=Math.atan2(p.y-o.last.clientY,p.x-o.last.clientX)/Math.PI*180,u=0>u?u+360:u,s+=u-o.pre.angle,isNaN(s)&&console.log(s),o.pre.angle=u;s/=c.getCount(),r.action=l.rotatemove,r.angleSpin=s,r.angle+=s,isNaN(r.angle)&&console.log(r.angle),n(a,t,r)}else{r.action=l.rotatestart;for(var d=0;d!==c.getCount();d++)o=c.getTrack(d),u=Math.atan2(p.y-o.last.clientY,p.x-o.last.clientX)/Math.PI*180,u=0>u?u+360:u,o.pre.angle=u,u||console.log(u);n(a,t,r)}i=p}},o.pointerUp=function(t){c.getTrack(t.pointerId);c.getCount()<2&&(r.angle=0),i=null},o.pointerCancel=function(){},o.pointerLeave=function(){},o.pointerOut=function(){}}function c(t,n,e){function i(){var t=0,n=0,e=0;u.sumLast&&(u.sumPre=u.sumLast);for(var i=0;i!==s.getCount();i++)for(var o=i+1;o!==s.getCount();o++)i!==o&&(u.sumStart||(n+=s.calculateDistance(s.getTrack(i).start.clientX,s.getTrack(o).start.clientX,s.getTrack(i).start.clientY,s.getTrack(o).start.clientY)),e+=s.calculateDistance(s.getTrack(i).last.clientX,s.getTrack(o).last.clientX,s.getTrack(i).last.clientY,s.getTrack(o).last.clientY),t++);u.sumLast=e/t,u.sumPre=u.sumPre||u.sumLast,u.sumStart=u.sumStart||n/t}{var o,a=this,r=D.GESTURE_EVENTS.pinch,c=!1,l={},u={sumStart:null,sumLast:null,sumPre:null},s=t,d={pinchstart:"pinchstart",pinchmove:"pinchmove",pinchend:"pinchend",pinchin:"pinchin",pinchout:"pinchout"},f={in:"in",out:"out"};p({threshold:Y},e)}a.pointerDown=function(){},a.pointerMove=function(t){if(s.getCount()>1){i();var e,a=u.sumStart-u.sumLast;l.zoom=Math.abs(u.sumLast/u.sumStart),l.pinchSize=u.sumLast,l.pointsCount=s.getCount(),c||(Math.abs(a)>.05*u.sumStart&&(l.action=d.pinchstart,n(r,t,l)),c=!0),e=l.zoom>1?f.out:f.in,l.action=d.pinchmove,n(r,t,l),(o||o!==e)&&(l.action=r+e,o=e,n(r,t,l))}},a.pointerUp=function(t){c&&(l.action=d.pinchend,l.pointsCount=s.getCount(),n(r,t,l),c=!1)},a.pointerCancel=function(){},a.pointerLeave=function(){},a.pointerOut=function(){}}function l(t,n,e){function i(){c=h.direction===m.all||h.direction===m.horizontal,l=h.direction===m.all||h.direction===m.vertical}function o(t,n){var e=void 0;return Math.abs(t)>Math.abs(n)?c&&(e=t>0?m.DirectionType.right:m.DirectionType.left):l&&(e=n>0?m.DirectionType.down:m.DirectionType.up),e}function a(t){var e=event.clientX-f.getTrack(event.pointerId).start.clientX,i=event.clientY-f.getTrack(event.pointerId).start.clientY;s.action=t,s.direction=o(e,i),s.distanceX=e,s.distanceY=i,n(v,event,s)}var r,c,l,u=this,s={},d=!1,f=t,v=D.GESTURE_EVENTS.pan,m={horizontal:"horizontal",vertical:"vertical",all:"all",DirectionType:{left:"left",right:"right",up:"up",down:"down"}},h=p({direction:m.all,threshold:Y},e),g={panstart:"panstart",panmove:"panmove",panend:"panend",panleft:"panleft",panright:"panright",panup:"panup",pandown:"pandown"};i(),u.pointerDown=function(){},u.pointerMove=function(t){var e,i,a=f.getTrack(t.pointerId),c=t.clientX-a.start.clientX,l=t.clientY-a.start.clientY,u=o(c,l);!d&&u?(e=Math.abs(c)>h.threshold&&u,i=Math.abs(l)>h.threshold&&u,(e||i)&&(s.action=g.panstart,s.direction=u,s.distanceX=c,s.distanceY=l,n(v,t,s),d=!0,r=u,s.action=v+u,n(v,t,s))):u&&(s.action=g.panmove,s.direction=u,s.distanceX=c,s.distanceY=l,n(v,t,s),r!==u&&(s.action=v+u,n(v,t,s),a.start.direction=u))},u.pointerUp=function(){d&&(a(g.panend),d=!1)},u.pointerCancel=function(){d&&(a(g.panend),d=!1)},u.pointerLeave=function(){d&&(a(g.panend),d=!1)},u.pointerOut=function(){d&&(a(g.panend),d=!1)}}function u(t,n){function e(t,n){var e=n||{};return e.x=t.clientX,e.y=t.clientY,e}function i(t,n,e,i){return Math.pow((n-t)*(n-t)+(i-e)*(i-e),.5)}function o(){for(var t,n,e,i,o,a,r,c=0,u=0,p=0;p!=d.length;f++){t=d[p].mas,n=s.length<t.length?s.length:t.length;for(var f=0;f!=n;f++)e=Math.pow(s[f].x*s[f].x+s[f].y*s[f].y,.5),i=Math.pow(t[f].x*t[f].x+t[f].y*t[f].y,.5),c=0,a=e*i===0?1:e*i,o=(s[f].x*t[f].x+s[f].y*t[f].y)/a+1,o=100*o/2,c+=o;c/=n,c>u&&(u=c,r=d[p].action)}l.action=r,l.probability=u}var a,r=this,c=D.GESTURE_EVENTS.curve,l={},u=20,p=70,s=[],d=[];r.addCurve=function(t,n){d[d.length]={action:t,mas:n}},r.clearCurves=function(){d=[]},r.pointerDown=function(t){d.length>0&&(s=[],a=e(t,a))},r.pointerMove=function(t){if(d.length>0)if(a){var n=i(a.x,t.clientX,a.y,t.clientY);n>u&&(s[s.length]={x:t.clientX-a.x,y:t.clientY-a.y},a=e(t,a))}else a=e(t,a)},r.pointerUp=function(t){if(d.length>0){var r=i(a.x,t.clientX,a.y,t.clientY);r>u&&(s[s.length]={x:t.clientX-a.x,y:t.clientY-a.y},a=e(t,a)),o(),l.probability>=p&&n(c,t,l)}},r.pointerCancel=function(){},r.pointerLeave=function(){},r.pointerOut=function(){}}function p(t,n){var e;for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function s(t,n,e){var i,o=document.createEvent("MouseEvents");if(o.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget),o.pointerId=b,o.pointerType=n.pointerType,e)for(i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);n.target.dispatchEvent(o)}function d(){x=new e;for(var t in I)v(C).call(C,I[t],G,!1);h(function(){var t,n,e=document.createElement("div");e.style.position="absolute",e.style.height="1in",e.style.width="1in",e.style.top="-100%",e.style.left="-100%",document.body.appendChild(e),t=e.offsetHeight,document.body.removeChild(e),n=t*f()*screen.pixelDepth/24,Y=20,w=new u(x,s),k.push(new i(x,s),new o(x,s),new l(x,s),new a(x,s),new c(x,s),new r(x,s),w),M&&M()})}function f(){return"devicePixelRatio"in window?window.devicePixelRatio:1}function v(t){return t.addEventListener||t.attachEvent}function m(t){return t.removeEventListener||t.detachEvent}function h(t){var n=v(document),e=m(document),i=document.addEventListener?"DOMContentLoaded":"onreadystatechange";n.call(document,i,function(){e.call(document,i,arguments.callee,!1),t()},!1)}function g(t){b=t.pointerId,x.setNewEvent(t);for(var n=0;n!=k.length;n++)k[n].pointerDown(t,x,s)}function E(t){var n,e,i;if(x.hasEvent(t.pointerId)&&(i=x.getTrack(t.pointerId),t.timeStamp-i.last.timeStamp>10)){if(n=Math.abs(i.last.clientX-i.start.clientX)>Y,e=Math.abs(i.last.clientY-i.start.clientY)>Y,n||e)for(var o=0;o!=k.length;o++)k[o].pointerMove(t,x,s);x.updateEvent(t,x)}}function S(t){if(x.hasEvent(t.pointerId)){x.setEndEvent(t);for(var n=0;n!=k.length;n++)k[n].pointerLeave(t,x,s);x.removeEvent(t.pointerId)}}function T(t){if(x.hasEvent(t.pointerId)){x.setEndEvent(t);for(var n=0;n!=k.length;n++)k[n].pointerCancel(t,x,s);x.removeEvent(t.pointerId)}}function y(t){if(x.hasEvent(t.pointerId)){x.setEndEvent(t);for(var n=0;n!=k.length;n++)k[n].pointerOut(t,x,s);x.removeEvent(t.pointerId)}}function X(t){if(x.hasEvent(t.pointerId)){x.setEndEvent(t);for(var n=0;n!=k.length;n++)k[n].pointerUp(t,x,s);x.removeEvent(t.pointerId)}}var Y,w,b,I={up:"pointerup",down:"pointerdown",move:"pointermove",over:"pointerover",cancel:"pointercancel",leave:"pointerleave",out:"pointerout"},C=t,D=this,k=[],M=n,G=function(t){switch(t.type){case I.down:g(t);break;case I.move:E(t);break;case I.cancel:T(t);break;case I.leave:S(t);break;case I.out:y(t);break;case I.up:X(t)}}.bind(D),x=new e;D.version="1.1.0",D.GESTURE_EVENTS={hold:"hold",curve:"curve",fling:"fling",longtap:"longtap",tap:"tap",doubletap:"doubletap",pan:"pan",pinch:"pinch",rotate:"rotate"},d(),D.destroy=function(){for(var t in this.TRACK_EVENTS)I.hasOwnProperty(t)&&m(C).call(C,I[t],G);C=null},D.addCurve=function(t,n){w.addCurve(t,n)},D.clearCurves=function(){w.clearCurves()},D.addGesture=function(t){k.push(t)},D.getDoubleGuardState=function(){return k[0].getDoubleGuardState()},D.setDoubleGuardState=function(t){k[0].setDoubleGuardState(t)}}return t.version="1.0.2",t});
//# sourceMappingURL=release/gesture.min.js.map